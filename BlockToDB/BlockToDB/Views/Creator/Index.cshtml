@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    string validationGroup = Guid.NewGuid().ToString();
}

<div class="wrapper">
    <div class="wrapper-header wrapper-header-creator d-sm-flex align-items-center justify-content-between">
        <h4 class="wrapper-header-title">@SharedResource.CreatorDB.ToStringSafe()</h4>
        <div class="wrapper-header-actions">
            <div id="importBtnId"></div>
            <div id="exportBtnId"></div>
            <div id="saveBtnId"></div>
            <div class="dropdown">
                <button class="dropbtn">@SharedResource.Generate.ToStringSafe()</button>
                <div class="dropdown-content">
                    <a href="#" onclick="generateBtnHandler(0)">@SharedResource.SQL.ToStringSafe()</a>
                    <a href="#" onclick="generateBtnHandler(1)">@SharedResource.CreateServ.ToStringSafe()</a>
                </div>
            </div>
        </div>
    </div>
    <div class="wrapper-inner-creator">
        @Html.Partial("_Editor")
    </div>
</div>

@Html.Partial("_ServerPopup")
@Html.Partial("_SchemaPopup")

<script>
    function generateBtnHandler(val) {
        if (val == 0) {
            $("#loadPanelId").dxLoadPanel("instance").show();
            generateScript();
        }
        else {
            $("#serverPopupId").dxPopup("instance").show();
        }
    }

    function generateScript() {
            var json = editor.toJSON();
             $.ajax({
                url: '@Url.Action("GenerateScriptFile", "Creator")',
                type: "post",
                data: {
                    Json: JSON.stringify(json),
                 },
                 success: function (data) {
                     window.location = "@Url.Action("Download", "Creator", new { id = "__id__", isScript = true })".replace(/__id__/g, data.Id);
                 }
            });
    }

    $(document).ready(function () {
        function saveSchemaBtnHandler() {
            $("#schemaPopupId").dxPopup("instance").show();
        }

        function importScript() {
            alert("tutaj importowanie gotowego skryptu po stronie js podpiąć");
        }

        function exportScript() {
            $("#schemaPopupId").dxPopup("instance").show();
        }

        $("#importBtnId").dxButton({
            elementAttr: { class: "btn btn-normal mr-1" },
            icon: "upload",
            onClick: importScript,
            text: "@SharedResource.Import.ToScriptStringSafe()",
            type: "normal"
        }).dxButton("instance");

        $("#exportBtnId").dxButton({
            elementAttr: { class: "btn btn-normal mr-1" },
            icon: "download",
            onClick: exportScript,
            text: "@SharedResource.Export.ToScriptStringSafe()",
            type: "normal",
            visible: @Json.Encode(!Context.User.Identity.IsAuthenticated),
        }).dxButton("instance");


        $("#saveBtnId").dxButton({
            elementAttr: { class: "btn btn-normal mr-1" },
            icon: "save",
            onClick: saveSchemaBtnHandler,
            text: "@SharedResource.Save.ToScriptStringSafe()",
            type: "normal",
            visible: @Json.Encode(Context.User.Identity.IsAuthenticated),
        }).dxButton("instance");
    });
</script>